[[webflux-http]]
= HTTP

所有基于 HTTP 的通信都应使用 <<http,using TLS>> 保护.

您可以在下面找到有关协助 HTTPS 使用的 WebFlux 特定功能的详细信息.

[[webflux-http-redirect]]
== 重定向 HTTPS

如果客户端使用 HTTP 而不是 HTTPS 发出请求,则可以将 Spring Security 配置为重定向到 HTTPS.

例如,以下 Java 配置会将所有 HTTP 请求重定向到 HTTPS:

.Redirect to HTTPS
====
.Java
[source,java,role="primary"]
----
@Bean
SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
	http
		// ...
		.redirectToHttps(withDefaults());
	return http.build();
}
----

.Kotlin
[source,kotlin,role="secondary"]
----
@Bean
fun springSecurityFilterChain(http: ServerHttpSecurity): SecurityWebFilterChain {
    return http {
        // ...
        redirectToHttps { }
    }
}
----
====

该配置可以轻松地包装在 `if` 语句中,仅在生产中启用.或者,可以通过查找仅在生产中发生的请求的属性来启用它.例如,如果生产环境添加了名为 `X-Forwarded-Proto` 的请求头,则可以使用以下 Java 配置:

.Redirect to HTTPS when X-Forwarded
====
.Java
[source,java,role="primary"]
----
@Bean
SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
	http
		// ...
		.redirectToHttps(redirect -> redirect
			.httpsRedirectWhen(e -> e.getRequest().getHeaders().containsKey("X-Forwarded-Proto"))
		);
	return http.build();
}
----

.Kotlin
[source,kotlin,role="secondary"]
----
@Bean
fun springSecurityFilterChain(http: ServerHttpSecurity): SecurityWebFilterChain {
    return http {
        // ...
        redirectToHttps {
            httpsRedirectWhen {
                it.request.headers.containsKey("X-Forwarded-Proto")
            }
        }
    }
}
----
====


[[webflux-hsts]]
== 严格的安全传输

Spring Security 提供对严格传输安全的支持,并默认启用它.

[[webflux-http-proxy-server]]
== 代理服务器配置

Spring Security 与 <<http-proxy-server,代理服务器集成>>.
