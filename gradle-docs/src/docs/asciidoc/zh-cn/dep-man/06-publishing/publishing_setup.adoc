[[publishing_components]]
= 将项目发布为模块

[[publishing_overview]]
大多数的软件项目都会构建一些东西供消费者使用，可以是其他软件项目使用的库，也可以是面向用户的应用程序，_Publishing_ 就是构建这种东西给消费者的过程。

在 Gradle 中，该过程如下所示:

1. 定义 <<#publishing_overview:what,要发布什么东西>>
2. 定义 <<#publishing_overview:where,发布到哪里>>
3. <<#publishing_overview:how,发布>>

这些步骤中的每一个都取决于您要将构件发布到的存储库的类型。 最常见的两种类型是和 Maven 兼容的和 Ivy 兼容的存储库，或简称 Maven 和 Ivy 存储库。

从 Gradle 6.0 开始，<<publishing_gradle_module_metadata.adoc#sec:understanding-gradle-module-md,Gradle Module Metadata>> 将始终与 Ivy XML 或 Maven POM 元数据文件一起发布。

[NOTE]
====
寻找有关 upload 任务和 `archives` 配置的信息？
请参阅 <<artifact_management.adoc#artifact_management,Legacy Publishing>> 章节，该功能现已弃用并计划删除。
====

Gradle 通过以 <<publishing_maven.adoc#publishing_maven,Maven Publish Plugin>> 和 <<publishing_ivy.adoc#publishing_ivy,Ivy Publish Plugin>> 的形式提供一些预打包的基础设施，
使发布到这些类型的存储库变得容易。 这些插件允许您配置要发布的内容并做最少的配置执行发布。

.The publishing process
image::{image-dir}/publishing-process.png[]

让我们更详细地看一下这些步骤：:

[[publishing_overview:what]]
要发布什么::
Gradle 需要知道要发布哪些文件和信息，以便消费者可以使用您的项目。
这通常是 <<dependency_management_terminology.adoc#sub:terminology_artifact,artifacts>> 和 Gradle 称为 <<dependency_management_terminology.adoc#sub:terminology_publication,publication>> 的元数据的组合。
publication 所包含的内容取决于您要发布的存储库的类型。
+
例如，发往 Maven 存储库的 publication 包括：:
+
* 一个或多个 artifacts — 通常由项目构建,
* Gradle Module Metadata 将描述已发布组件的变体,
* Maven POM 文件将识别主要构建及其依赖项。

主要构件通常是项目的生产 JAR，次要工件可能由 "-sources" 和 "-javadoc" JARs 组成。

+
此外，Gradle 将发布上述所有内容的校验码，并在配置为这样做时发布 <<publishing_signing.adoc#,signatures>>。

[[publishing_overview:where]]
发布到哪里::
Gradle 需要知道您将构件发布到哪里，以便消费者能够获得它们。这是通过 <<dependency_management_terminology.adoc#sub:terminology_repository,repositories>> 完成的，repositories 存储和提供各种构件。
Gradle 还需要与仓库进行交互，这就是为什么您必须提供仓库的类型及其位置。

[[publishing_overview:how]]
如何发布::
Gradle 会自动为 publication 和 repository 的所有可能组合生成发布任务，允许您将任何构件发布到任何存储库。如果要发布到 Maven 存储库，则任务的类型为 link:{groovyDslPath}/org.gradle.api.publish.maven.tasks.PublishToMavenRepository.html[PublishToMavenRepository]，
而对于 Ivy 存储库，任务的类型为 link:{groovyDslPath}/org.gradle.api.publish.ivy.tasks.PublishToIvyRepository.html[PublishToIvyRepository]。

下面是一个演示整个发布过程的实际示例.

[[sec:basic_publishing]]
== 设置 publishing 基本配置

无论您是什么类型的项目，发布的第一步都是应用适当的发布插件。如介绍中所述，Gradle 通过以下插件支持 Maven 和 Ivy 存储库：

* <<publishing_maven.adoc#publishing_maven,Maven Publish Plugin>>
* <<publishing_ivy.adoc#publishing_ivy,Ivy Publish Plugin>>

它们提供了为相应存储库类型配置发布所需的特定 publishing 和 repository 类。由于 Maven 存储库是最常用的存储库，因此它们将成为此示例和本章中其他示例的基础。别担心，我们将解释如何调整 Ivy 存储库。

假设我们正在处理一个简单的 Java 库项目，因此仅应用以下插件:

.应用必要的插件
====
include::{snippets-dir}/publishing/javaLibrary/groovy/build.gradle[tags=apply-plugins]
include::{snippets-dir}/publishing/javaLibrary/kotlin/build.gradle.kts[tags=apply-plugins]
====

应用适当的插件后，您可以配置 publications 和 repositories。对于此示例，我们希望将项目的生产的 JAR 文件（由 `jar` 任务生成的文件）发布到自定义的 Maven 存储库。我们使用 `publishing {}` 块来做到这一点，该块由 link:{groovyDslPath}/org.gradle.api.publish.PublishingExtension.html[PublishingExtension] 提供支持

.Configuring a Java library for publishing
====
include::{snippets-dir}/publishing/javaLibrary/groovy/build.gradle[tags=configure-publishing]
include::{snippets-dir}/publishing/javaLibrary/kotlin/build.gradle.kts[tags=configure-publishing]
====

定义了一个名为 "myLibrary" 的 publication ，该 publication 可以通过其 link:{groovyDslPath}/org.gradle.api.publish.maven.MavenPublication.html[MavenPublication] 类型发布到 Maven 存储库。
此发布仅包含产生的 JAR 文件及其元数据，它们组合在一起表示项目 `java` <<dependency_management_terminology.adoc#sub:terminology_component,component>> 。

NOTE: 组件是定义 publication 的标准方法。它们由插件提供，通常是有不同的语言或平台提供。例如，Java 插件定义了 `components.java` link:{javadocPath}/org/gradle/api/component/SoftwareComponent.html[SoftwareComponent]，
而 War 插件定义了 `components.web`。

该示例还定义了一个名为 "myRepo" 的基于文件路径的 Maven 存储库。这种基于文件路径的存储库对于示例来说很方便，但在实际构建中通常使用基于 HTTPS 的存储库服务器，例如 Maven Central 或公司内部服务器。

NOTE: 您可以定义一个且只能定义一个没有名称的存储库。他会转化为 Maven 存储库的默认名称 "Maven" 和 Ivy 存储库的 "Ivy"。必须为所有其他存储库定义显式指定名称。

结合项目的 `group` 和 `version`，publication 和 repository 的定义提供了 Gradle 发布项目产生 JAR 所需的一切。然后，Gradle 将创建一个 `publishMyLibraryPublicationToMyRepoRepository` 任务。其名称基于 `publish__PubName__PublicationTo__RepoName__Repository` 模板。
有关此任务的性质以及您可能可以使用的任何其他任务的更多详细信息，请参阅相应的发布插件的文档。

您可以直接单独执行 publishing 任务，或执行  `publish` 任务，这将运行所有可用的发布任务。在此示例中，`publish` 将运行 `publishMyLibraryPublicationToMavenRepository`

[NOTE]
====
发布到 Ivy 存储库的基本配置和 Maven 非常相似：您只需使用 Ivy Publish 插件，替换为 link:{groovyDslPath}/org.gradle.api.publish.ivy.IvyPublication.html[IvyPublication]，然后使用 `ivy` 而不是 `maven` 存储库定义。

这两种类型的存储库之间存在差异，特别是在每种存储库支持的额外元数据方面 - 例如，Maven 存储库需要 POM 文件，而 Ivy 存储库有自己的元数据格式 - 因此请参阅插件章节以获取有关如何为您正在使用的任何存储库类型配置 publications 和 repositories 的全面信息。
====

这就是基本用例的全部内容。但是，许多项目需要更好地控制发布的内容，因此我们将在以下部分中介绍几种常见方案。